<!-- app/views/rooms/show.html.erb -->
<h1><%= @room.name %></h1>

<% if current_user %>
  <p>Current User:</p>
  <p>Name: <%= current_user.email %></p>
  <p>ID: <%= current_user.id %></p>
<% else %>
  <p>No user logged in.</p>
<% end %>

<div class="players-text">
  <h2>Players in the room</h2>
</div>

<div class="characteristics-container">
  <!-- Characteristics of other players -->
  <% @players.each do |player| %>
    <div class="characteristics-list">
      <p><strong>Email:</strong> <%= player.user.email %></p>
      <% if player.characteristic.present? %>
        <ul>
          <% player.characteristic.attributes.each do |name, value| %>
            <% unless ['id', 'created_at', 'updated_at', 'player_id'].include?(name) %>
              <li>
                <strong><%= name.titleize %>:</strong>
                <% if current_user == player.user || (player.visible_characteristics&.include?(name) && @room.turn_status == 'voting') %>
                  <%= value %>
                <% else %>
                  <%= "Hidden" %>
                <% end %>
              </li>
            <% end %>
          <% end %>
        </ul>
      <% else %>
        <p>No characteristics available.</p>
      <% end %>
    </div>
  <% end %>
</div>

<% unless @room.players.exists?(user_id: current_user.id) %>
  <%= button_to 'Take Slot', take_slot_room_path(@room), method: :post %>
<% end %>

<% if @room.owner == current_user %>
  <% if @room.players.count >= 2 %>
    <%= button_to 'Start Game', start_game_room_path(@room), method: :post %>
  <% else %>
    <p>Waiting for more players to start the game...</p>
  <% end %>
<% end %>

<% if @room.owner == current_user %>
  <%= form_for @room, method: :delete, data: { confirm: 'Are you sure?' } do |f| %>
    <%= f.submit 'Delete Room' %>
  <% end %>
<% end %>

# <% if @room.turn_status == 'waiting_for_characteristic' %>
#   <h2>Open Characteristics for Other Players</h2>
#   <ul>
#     <% @players.each do |player| %>
#       <li>
#         <%= player.user.email %>
#         <% Characteristic.attribute_names.each do |characteristic_name| %>
#           <%= button_to "Open #{characteristic_name.titleize} for Others", set_visible_characteristic_room_path(@room, characteristic_name: characteristic_name), method: :post, class: 'open-characteristic-button' %>
#         <% end %>
#       </li>
#     <% end %>
#   </ul>
# <% end %>

<h1>Weather Information</h1>
<% if @weather_info.present? %>
  <p>Temperature: <%= (@weather_info['main']['temp'] - 273.15).round %> °C</p>
  <p>Humidity: <%= @weather_info['main']['humidity'] %> %</p>
<% else %>
  <p>No weather information available.</p>
<% end %>


<% @players.each do |player| %>
  <div class="characteristics-list">
    <!-- Решта HTML-коду ... -->

    <% if current_user.present? && current_user != player.user && @room.turn_status == 'voting' %>
      <%= form_tag vote_for_player_room_path(@room, player_id: player.id), method: :post do %>
        <%= submit_tag "Голосувати за #{player.user.email}", class: 'vote-button' %>
      <% end %>
    <% end %>
  </div>
<% end %>

<!-- Додаємо це вниз сторінки -->
<div id="vote-message" style="display: none;"></div>